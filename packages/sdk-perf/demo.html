<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§èƒ½ç›‘æ§é¢æ¿ç¤ºä¾‹</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .demo-title {
            font-size: 32px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 16px;
        }
        
        .demo-description {
            font-size: 18px;
            color: #6b7280;
            line-height: 1.6;
        }
        
        .demo-controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }
        
        .controls-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .control-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-btn {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .control-btn:hover {
            background: #2563eb;
        }
        
        .control-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .status-indicator {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-running {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-stopped {
            background: #fee2e2;
            color: #991b1b;
        }
        
        #dashboard-container {
            width: 100%;
            min-height: 600px;
        }
        
        .demo-info {
            background: #eff6ff;
            border: 1px solid #dbeafe;
            border-radius: 8px;
            padding: 16px;
            margin-top: 24px;
        }
        
        .demo-info h3 {
            margin-top: 0;
            color: #1e40af;
        }
        
        .demo-info ul {
            margin-bottom: 0;
        }
        
        .demo-info li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1 class="demo-title">ğŸš€ æ€§èƒ½ç›‘æ§é¢æ¿ç¤ºä¾‹</h1>
            <p class="demo-description">
                è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ€§èƒ½ç›‘æ§å¯è§†åŒ–é¢æ¿ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ @wfynbzlx666/sdk-perf 
                è¿›è¡Œå®æ—¶æ€§èƒ½ç›‘æ§ã€æ•°æ®å¯è§†åŒ–å’Œæ™ºèƒ½å»ºè®®ç”Ÿæˆã€‚
            </p>
        </div>
        
        <div class="demo-controls">
            <h3 class="controls-title">æ§åˆ¶é¢æ¿</h3>
            <div class="control-group">
                <button id="start-monitoring" class="control-btn">å¼€å§‹ç›‘æ§</button>
                <button id="stop-monitoring" class="control-btn" disabled>åœæ­¢ç›‘æ§</button>
                <button id="simulate-data" class="control-btn">æ¨¡æ‹Ÿæ•°æ®</button>
                <button id="clear-data" class="control-btn">æ¸…é™¤æ•°æ®</button>
                <button id="export-json" class="control-btn">å¯¼å‡º JSON</button>
                <button id="export-csv" class="control-btn">å¯¼å‡º CSV</button>
                <span id="status" class="status-indicator status-stopped">å·²åœæ­¢</span>
            </div>
        </div>
        
        <div id="dashboard-container"></div>
        
        <div class="demo-info">
            <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li><strong>å¼€å§‹ç›‘æ§</strong>ï¼šå¯åŠ¨çœŸå®çš„æ€§èƒ½ç›‘æ§ï¼Œæ”¶é›† Web Vitals å’Œå…¶ä»–æ€§èƒ½æŒ‡æ ‡</li>
                <li><strong>æ¨¡æ‹Ÿæ•°æ®</strong>ï¼šç”Ÿæˆæ¨¡æ‹Ÿçš„æ€§èƒ½æ•°æ®ï¼Œç”¨äºæ¼”ç¤ºé¢æ¿åŠŸèƒ½</li>
                <li><strong>æ™ºèƒ½å»ºè®®</strong>ï¼šåŸºäºæ”¶é›†çš„æ•°æ®è‡ªåŠ¨ç”Ÿæˆæ€§èƒ½ä¼˜åŒ–å»ºè®®</li>
                <li><strong>å®æ—¶å›¾è¡¨</strong>ï¼šæ”¯æŒæŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€ä»ªè¡¨ç›˜ç­‰å¤šç§å›¾è¡¨ç±»å‹</li>
                <li><strong>æ•°æ®å¯¼å‡º</strong>ï¼šæ”¯æŒå¯¼å‡º JSON å’Œ CSV æ ¼å¼çš„æ€§èƒ½æ•°æ®</li>
            </ul>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿ SDK åŠ è½½ -->
    <script>
        // æ¨¡æ‹Ÿ SDK ç±»å’ŒåŠŸèƒ½ï¼ˆå®é™…ä½¿ç”¨æ—¶åº”è¯¥ import çœŸå®çš„ SDKï¼‰
        class MockPerf {
            static metrics = []
            static observers = []
            static options = {}
            
            static init(options) {
                this.options = options
                console.log('Mock Perf initialized with options:', options)
                
                // æ¨¡æ‹Ÿè‡ªåŠ¨æ”¶é›† Web Vitals
                if (options.autoEnableWebVitals !== false) {
                    this.simulateWebVitals()
                }
            }
            
            static simulateWebVitals() {
                setTimeout(() => {
                    // æ¨¡æ‹Ÿ LCP
                    this.generateMetric('vitals', 'LCP', this.randomValue(1000, 4000), 'ms')
                    
                    // æ¨¡æ‹Ÿ FID
                    this.generateMetric('vitals', 'FID', this.randomValue(50, 300), 'ms')
                    
                    // æ¨¡æ‹Ÿ CLS
                    this.generateMetric('vitals', 'CLS', this.randomValue(0.05, 0.3), 'score')
                    
                    // æ¨¡æ‹Ÿ FCP
                    this.generateMetric('vitals', 'FCP', this.randomValue(800, 3000), 'ms')
                    
                    // æ¨¡æ‹Ÿ TTFB
                    this.generateMetric('vitals', 'TTFB', this.randomValue(200, 1500), 'ms')
                }, 1000)
            }
            
            static generateMetric(type, name, value, unit) {
                const rating = this.getRating(name, value)
                const metric = {
                    type,
                    name,
                    value,
                    unit,
                    rating,
                    ts: Date.now(),
                    source: 'mock'
                }
                
                this.metrics.push(metric)
                if (this.options.onMetric) {
                    this.options.onMetric(metric)
                }
            }
            
            static getRating(name, value) {
                const thresholds = {
                    'LCP': { good: 2500, poor: 4000 },
                    'FID': { good: 100, poor: 300 },
                    'CLS': { good: 0.1, poor: 0.25 },
                    'FCP': { good: 1800, poor: 3000 },
                    'TTFB': { good: 800, poor: 1800 }
                }
                
                const threshold = thresholds[name]
                if (!threshold) return 'good'
                
                if (value <= threshold.good) return 'good'
                if (value <= threshold.poor) return 'needs-improvement'
                return 'poor'
            }
            
            static randomValue(min, max) {
                return Math.random() * (max - min) + min
            }
            
            static stop() {
                console.log('Mock Perf stopped')
                this.observers = []
            }
            
            static mark(name) {
                console.log('Mock mark:', name)
            }
            
            static measure(name, start, end) {
                const value = Math.random() * 100
                this.generateMetric('measure', name, value, 'ms')
            }
        }

        // æ¨¡æ‹Ÿ PerformanceAdvisor
        class MockPerformanceAdvisor {
            constructor() {
                this.metrics = []
            }
            
            addMetric(metric) {
                this.metrics.push(metric)
            }
            
            generateAnalysis() {
                const vitalsMetrics = this.metrics.filter(m => m.type === 'vitals')
                const poorMetrics = vitalsMetrics.filter(m => m.rating === 'poor')
                const goodMetrics = vitalsMetrics.filter(m => m.rating === 'good')
                
                const score = Math.max(0, 100 - (poorMetrics.length * 20))
                const grade = score >= 90 ? 'A' : score >= 80 ? 'B' : score >= 70 ? 'C' : score >= 60 ? 'D' : 'F'
                
                const advices = []
                
                if (poorMetrics.length > 0) {
                    advices.push({
                        id: 'vitals-poor',
                        type: 'error',
                        priority: 'critical',
                        category: 'performance',
                        title: 'æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡éœ€è¦ä¼˜åŒ–',
                        description: `å‘ç° ${poorMetrics.length} ä¸ªæ€§èƒ½æŒ‡æ ‡è¡¨ç°è¾ƒå·®`,
                        suggestions: [
                            'ä¼˜åŒ–å›¾ç‰‡åŠ è½½å’Œæ ¼å¼é€‰æ‹©',
                            'å‡å°‘JavaScriptæ‰§è¡Œæ—¶é—´',
                            'æ”¹å–„é¡µé¢å¸ƒå±€ç¨³å®šæ€§',
                            'ä¼˜åŒ–æœåŠ¡å™¨å“åº”æ—¶é—´'
                        ],
                        relatedMetrics: poorMetrics.map(m => m.name),
                        expectedImprovement: 'å¯æå‡æ•´ä½“æ€§èƒ½è¯„åˆ† 20-40%',
                        difficulty: 'medium',
                        timestamp: Date.now()
                    })
                }
                
                return {
                    overallScore: score,
                    grade,
                    criticalIssues: poorMetrics.length,
                    advices,
                    summary: {
                        strengths: goodMetrics.length > 0 ? [`${goodMetrics.length} ä¸ªæŒ‡æ ‡è¡¨ç°è‰¯å¥½`] : [],
                        weaknesses: poorMetrics.length > 0 ? [`${poorMetrics.length} ä¸ªæŒ‡æ ‡éœ€è¦æ”¹è¿›`] : [],
                        quickWins: ['å¯ç”¨å›¾ç‰‡å‹ç¼©', 'ä¼˜åŒ–CSSåŠ è½½é¡ºåº']
                    },
                    timestamp: Date.now()
                }
            }
        }

        // æ¨¡æ‹Ÿ PerformanceDashboard
        class MockPerformanceDashboard {
            constructor(options) {
                this.container = options.container
                this.options = options
                this.advisor = new MockPerformanceAdvisor()
                this.charts = new Map()
                this.isInitialized = false
            }
            
            init() {
                if (this.isInitialized) return
                
                this.container.innerHTML = `
                    <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid #e5e7eb;">
                            <h1 style="font-size: 24px; font-weight: 600; margin: 0;">æ€§èƒ½ç›‘æ§é¢æ¿</h1>
                            <div style="display: flex; gap: 12px;">
                                <button onclick="window.exportData('json')" style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; border-radius: 6px; cursor: pointer;">å¯¼å‡º JSON</button>
                                <button onclick="window.exportData('csv')" style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; border-radius: 6px; cursor: pointer;">å¯¼å‡º CSV</button>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
                            <div id="charts-area" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <div style="text-align: center; color: #6b7280; padding: 40px;">æ­£åœ¨åŠ è½½æ€§èƒ½æ•°æ®...</div>
                            </div>
                            
                            <div id="advice-area" style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px;">
                                <h3 style="margin-top: 0;">ğŸ¯ æ€§èƒ½å»ºè®®</h3>
                                <div style="text-align: center; color: #6b7280; padding: 20px;">æ­£åœ¨åˆ†ææ€§èƒ½æ•°æ®...</div>
                            </div>
                        </div>
                    </div>
                `
                
                this.isInitialized = true
            }
            
            addMetric(metric) {
                this.advisor.addMetric(metric)
                this.updateChart(metric)
                this.updateAdvice()
            }
            
            updateChart(metric) {
                const chartsArea = this.container.querySelector('#charts-area')
                const chartId = `chart-${metric.type}-${metric.name}`
                
                let chartElement = this.container.querySelector(`#${chartId}`)
                if (!chartElement) {
                    // ç§»é™¤åŠ è½½æç¤º
                    const loading = chartsArea.querySelector('div')
                    if (loading && loading.textContent.includes('æ­£åœ¨åŠ è½½')) {
                        loading.remove()
                    }
                    
                    chartElement = document.createElement('div')
                    chartElement.id = chartId
                    chartElement.style.cssText = 'background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px;'
                    chartsArea.appendChild(chartElement)
                }
                
                const displayName = this.getDisplayName(metric.name)
                const color = this.getColorByRating(metric.rating)
                
                chartElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h4 style="margin: 0; font-size: 16px; font-weight: 600;">${displayName}</h4>
                        <span style="font-size: 12px; color: #6b7280;">${metric.value.toFixed(1)} ${metric.unit || ''}</span>
                    </div>
                    <div style="height: 100px; background: #f9fafb; border-radius: 4px; display: flex; align-items: end; padding: 10px;">
                        <div style="width: 100%; height: ${Math.min(80, (metric.value / 100) * 80)}px; background: ${color}; border-radius: 2px; margin-right: 4px;"></div>
                    </div>
                    <div style="margin-top: 8px; text-align: center;">
                        <span style="display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 12px; background: ${color}20; color: ${color};">
                            ${metric.rating || 'N/A'}
                        </span>
                    </div>
                `
            }
            
            updateAdvice() {
                const analysis = this.advisor.generateAnalysis()
                const adviceArea = this.container.querySelector('#advice-area')
                
                if (analysis.advices.length === 0) {
                    adviceArea.innerHTML = `
                        <h3 style="margin-top: 0;">ğŸ¯ æ€§èƒ½å»ºè®®</h3>
                        <div style="text-align: center; color: #6b7280;">æš‚æ— å»ºè®®ï¼Œç»§ç»­æ”¶é›†æ•°æ®ä¸­...</div>
                    `
                    return
                }
                
                adviceArea.innerHTML = `
                    <h3 style="margin-top: 0; display: flex; justify-content: space-between; align-items: center;">
                        ğŸ¯ æ€§èƒ½å»ºè®®
                        <span style="font-size: 14px; font-weight: normal; color: #6b7280;">
                            è¯„åˆ†: ${analysis.overallScore}/100 (${analysis.grade})
                        </span>
                    </h3>
                    ${analysis.advices.map(advice => `
                        <div style="padding: 12px; margin-bottom: 12px; border-radius: 6px; border-left: 4px solid ${this.getPriorityColor(advice.priority)}; background: ${this.getPriorityColor(advice.priority)}10;">
                            <div style="font-weight: 600; margin-bottom: 4px;">
                                ${this.getPriorityIcon(advice.priority)} ${advice.title}
                            </div>
                            <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">
                                ${advice.description}
                            </div>
                            <ul style="font-size: 13px; margin: 0; padding-left: 16px;">
                                ${advice.suggestions.slice(0, 2).map(s => `<li>${s}</li>`).join('')}
                            </ul>
                        </div>
                    `).join('')}
                `
            }
            
            getDisplayName(name) {
                const names = {
                    'LCP': 'æœ€å¤§å†…å®¹ç»˜åˆ¶',
                    'FID': 'é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ',
                    'CLS': 'ç´¯ç§¯å¸ƒå±€åç§»',
                    'FCP': 'é¦–æ¬¡å†…å®¹ç»˜åˆ¶',
                    'TTFB': 'é¦–å­—èŠ‚å“åº”æ—¶é—´'
                }
                return names[name] || name
            }
            
            getColorByRating(rating) {
                switch (rating) {
                    case 'good': return '#10b981'
                    case 'needs-improvement': return '#f59e0b'
                    case 'poor': return '#ef4444'
                    default: return '#3b82f6'
                }
            }
            
            getPriorityColor(priority) {
                switch (priority) {
                    case 'critical': return '#ef4444'
                    case 'high': return '#f97316'
                    case 'medium': return '#f59e0b'
                    case 'low': return '#3b82f6'
                    default: return '#6b7280'
                }
            }
            
            getPriorityIcon(priority) {
                switch (priority) {
                    case 'critical': return 'ğŸš¨'
                    case 'high': return 'âš ï¸'
                    case 'medium': return 'ğŸ’¡'
                    case 'low': return 'â„¹ï¸'
                    default: return 'ğŸ“'
                }
            }
            
            exportData(format) {
                const data = {
                    metrics: this.advisor.metrics,
                    analysis: this.advisor.generateAnalysis(),
                    timestamp: Date.now()
                }
                
                const filename = `performance-data-${Date.now()}.${format}`
                let content, mimeType
                
                if (format === 'json') {
                    content = JSON.stringify(data, null, 2)
                    mimeType = 'application/json'
                } else {
                    // CSV format
                    const lines = [
                        'Metric,Value,Unit,Rating,Timestamp',
                        ...data.metrics.map(m => `${m.name},${m.value},${m.unit || ''},${m.rating || ''},${m.ts}`)
                    ]
                    content = lines.join('\n')
                    mimeType = 'text/csv'
                }
                
                const blob = new Blob([content], { type: mimeType })
                const url = URL.createObjectURL(blob)
                
                const a = document.createElement('a')
                a.href = url
                a.download = filename
                a.click()
                
                URL.revokeObjectURL(url)
            }
            
            destroy() {
                this.container.innerHTML = ''
                this.isInitialized = false
            }
        }

        // å…¨å±€çŠ¶æ€
        let dashboard = null
        let monitoringTimer = null
        let isMonitoring = false

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('dashboard-container')
            
            dashboard = new MockPerformanceDashboard({
                container: container,
                theme: 'light',
                showAdvice: true
            })
            
            dashboard.init()
            
            // ç»‘å®šäº‹ä»¶
            document.getElementById('start-monitoring').addEventListener('click', startMonitoring)
            document.getElementById('stop-monitoring').addEventListener('click', stopMonitoring)
            document.getElementById('simulate-data').addEventListener('click', simulateData)
            document.getElementById('clear-data').addEventListener('click', clearData)
            document.getElementById('export-json').addEventListener('click', () => exportData('json'))
            document.getElementById('export-csv').addEventListener('click', () => exportData('csv'))
        })

        function startMonitoring() {
            if (isMonitoring) return
            
            isMonitoring = true
            updateButtons()
            
            // åˆå§‹åŒ–æ€§èƒ½ç›‘æ§
            MockPerf.init({
                autoEnableWebVitals: true,
                onMetric: (metric) => {
                    dashboard.addMetric(metric)
                }
            })
            
            // å®šæœŸç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            monitoringTimer = setInterval(() => {
                // æ¨¡æ‹Ÿå…¶ä»–æ€§èƒ½æŒ‡æ ‡
                if (Math.random() > 0.7) {
                    MockPerf.generateMetric('memory', 'memory-usage', Math.random() * 100, 'percent')
                }
                
                if (Math.random() > 0.8) {
                    MockPerf.generateMetric('navigation', 'dns-lookup', Math.random() * 200, 'ms')
                }
                
                if (Math.random() > 0.6) {
                    MockPerf.generateMetric('custom', 'fps', 30 + Math.random() * 30, 'fps')
                }
            }, 2000)
        }

        function stopMonitoring() {
            if (!isMonitoring) return
            
            isMonitoring = false
            updateButtons()
            
            if (monitoringTimer) {
                clearInterval(monitoringTimer)
                monitoringTimer = null
            }
            
            MockPerf.stop()
        }

        function simulateData() {
            // ç”Ÿæˆä¸€æ‰¹æ¨¡æ‹Ÿæ•°æ®
            const metrics = [
                { type: 'vitals', name: 'LCP', value: 2200, unit: 'ms', rating: 'good' },
                { type: 'vitals', name: 'FID', value: 150, unit: 'ms', rating: 'needs-improvement' },
                { type: 'vitals', name: 'CLS', value: 0.15, unit: 'score', rating: 'needs-improvement' },
                { type: 'memory', name: 'memory-usage', value: 75, unit: 'percent', rating: 'needs-improvement' },
                { type: 'navigation', name: 'dns-lookup', value: 120, unit: 'ms', rating: 'good' },
                { type: 'custom', name: 'fps', value: 58, unit: 'fps', rating: 'good' }
            ]
            
            metrics.forEach((metric, index) => {
                setTimeout(() => {
                    dashboard.addMetric({
                        ...metric,
                        ts: Date.now(),
                        source: 'simulated'
                    })
                }, index * 200)
            })
        }

        function clearData() {
            dashboard.destroy()
            dashboard.init()
        }

        function exportData(format) {
            dashboard.exportData(format)
        }

        function updateButtons() {
            const startBtn = document.getElementById('start-monitoring')
            const stopBtn = document.getElementById('stop-monitoring')
            const status = document.getElementById('status')
            
            if (isMonitoring) {
                startBtn.disabled = true
                stopBtn.disabled = false
                status.textContent = 'ç›‘æ§ä¸­'
                status.className = 'status-indicator status-running'
            } else {
                startBtn.disabled = false
                stopBtn.disabled = true
                status.textContent = 'å·²åœæ­¢'
                status.className = 'status-indicator status-stopped'
            }
        }

        // å…¨å±€å¯¼å‡ºå‡½æ•°
        window.exportData = exportData
    </script>
</body>
</html>