## v1

### 总览与定位
- **项目定位与差异化**: 这个 SDK 相比 axios/Socket.IO 官方客户端、web-vitals 等现成方案的核心优势和不可替代点是什么？不做什么？
- **架构边界**: `sdk-core`、`sdk-http`、`sdk-realtime`、`sdk-perf`、`sdk-telemetry`、`adapters` 各自职责与依赖方向？如何避免环依赖与“万能工具箱化”？

### Monorepo 与工程化
- **包导出与 Tree-shaking**: `package.json` 的 `exports`、`sideEffects`、ESM/CJS 双包策略如何处理“dual package hazard”？如何验证 treeshake 成效？
- **构建与类型**: 为什么选 `tsup`？如何产出 `.d.ts`、sourcemap、条件导出、浏览器/Node 条件？如何做 Bundle 体积守护？
- **版本与发布**: 语义化版本、pre-release 流程、变更日志、回滚策略？多包协同升级如何避免破坏性发布？

### SDK 设计与可用性
- **插件/中间件顺序**: 在 `sdk-http` 里重试、限流、去重、熔断、鉴权、遥测的执行顺序如何定义？为什么？
- **取消与超时**: 如何统一 `AbortController` 与 axios 取消？超时与重试的交互边界？
- **上下文传播**: request-scoped metadata（traceId、用户信息）如何在插件链路中传递？

### HTTP SDK（可靠性与弹性）
- **重试策略**: 何时重试/不重试（幂等方法、POST 幂等键）？指数退避与抖动公式选型与参数？
- **熔断器**: 三态（Closed/Half-Open/Open）切换条件、滑动窗口统计口径、与重试/限流的交互？
- **去重与幂等**: Request Key 如何生成（方法、URL、查询、Body 归一化、Header 白/黑名单）？TTL 与内存占用控制？
- **限流算法**: Token Bucket vs Leaky Bucket 取舍？全局 VS 每路由 VS 每用户？
- **失败分类**: DNS/超时/5xx/429/网络离线的差异化处理与 Telemetry 维度上报？
- **安全**: CORS/CSRF、Cookie/Token 存储、刷新 token 的原子性与并发抖动处理？

### Realtime/WebSocket
- **重连与心跳**: 心跳间隔、超时判定、指数退避、最大抖动、前后台可见性切换策略？
- **消息可靠性**: ACK/重传/顺序性保证级别？如何在 Socket.IO 与裸 `ws` 下统一抽象？
- **多标签页复用**: `BroadcastChannel`/SharedWorker 复用连接？锁与主选举如何做，如何避免“惊群”？
- **背压与丢包**: 大量消息如何节流/批处理？服务端限速返回如何感知并降级？

### 性能 SDK（Web Vitals/PerformanceObserver）
- **指标口径**: LCP/CLS/TTFB/INP 的定义与阈值；INP 与 FID 的关系？SPA 路由变更如何重新计算？
- **采集细节**: `PerformanceObserver` 条目去重、bfcache、visibilitychange、`pagehide`/`beforeunload` 的兼容策略？
- **长任务与子任务**: Long Task 的聚合与归因；元素级归因（element timing）是否支持？
- **上报策略**: `sendBeacon`/`fetch keepalive`/批量与采样、页面关闭时数据可靠送达？

### Telemetry/埋点与存储
- **事件模型**: schema 演进与版本治理、PII 脱敏与合规、采样/限流配置的动态下发？
- **离线与重放**: IndexedDB/LocalStorage 选择、批处理、失败队列与最大占用、幂等去重？
- **链路追踪**: traceId/spanId 生成与跨请求传播；如何关联 HTTP 错误与性能数据？

### Adapters（React/Vue）
- **生命周期绑定**: 在 React/Vue 中如何注入与清理监听？StrictMode 双调用的幂等保障？
- **SSR/Hydration**: 采集与实时连接在 SSR 下如何禁用/延迟至客户端？
- **Hook 设计**: `useXxx` 如何避免渲染抖动与内存泄漏？依赖项与订阅管理？

### 并发与跨页协作
- **锁实现**: `sdk-core/locks` 的公平性/可重入性/超时回收？崩溃恢复？
- **任务队列**: `task-queue` 的吞吐、优先级、公平调度、失败重试与回压？

### 测试、可观测与质量
- **测试金字塔**: 单测/合测/契约测试/端到端；如何 mock WebSocket/网络波动？
- **混沌与容灾**: 人为注入故障（抖动、断网、5xx 风暴）验证熔断与降级是否生效？
- **监控与报警**: 线上埋点指标看板与阈值；如何用 Telemetry 自监控 SDK 自身问题？

### 代码走查点（我会点名看代码/讲实现）
- **`sdk-realtime/src/realtime.ts`**: 重连状态机、心跳/超时检测实现，如何和可见性 API、网络状态协同？
- **`sdk-http` 插件链**: 插件顺序与错误传播；如何做到“每个插件既能短路也能透传”？
- **`sdk-perf`**: LCP/CLS/INP 的采集代码，如何处理 SPA 二次渲染与 bfcache？
- **`sdk-telemetry`**: 存储层与批量上报、失败重试、采样开关；如何避免丢数与风暴？

### 现场小题（15–30 分钟任选其二）
- **写一个带抖动的指数退避重试**（可配置幂等方法白名单，支持 Abort）。
- **实现熔断器三态**（滑动窗口统计失败率，半开探测数量与放量策略）。
- **实现 Token Bucket 限流**（全局与每路由两级限流）。
- **用 PerformanceObserver 采 LCP 与 INP**（处理 visibilitychange 与 bfcache）。
- **WebSocket 心跳+重连**（前后台切换暂停/恢复，最大重连时长）。

### 杀手级追问（易翻车）
- **顺序与相互影响**: “重试+熔断+限流+去重”在边界场景下的相互作用次序与冲突消解？
- **边界兼容**: Safari `sendBeacon`/keepalive/页面关闭兼容；移动端前后台切换导致的计时偏差？
- **安全与隐私**: Token 放哪、XSS/CSRF 风险点、CSP 与第三方脚本隔离？
- **性能与资源**: 大量待重放事件与去重索引的内存上限、淘汰策略与可观测性？

——
如果你想，我可以按上面“现场小题”任选两题给出标准解法参考与评分点，或对你的现实现状做一次针对性“模拟面试”。

## v2
### 定位与价值
- 你的 SDK 针对谁、解决什么痛点？和 axios/Socket.IO/web‑vitals 官方库相比的核心差异与不可替代点？
- 不做什么？有哪些边界明确拒收的需求？

### 架构与 Monorepo
- 为什么选 Monorepo？多包间依赖方向如何约束，如何避免环依赖？
- 包划分：`core/http/realtime/perf/telemetry/adapters` 各自职责与协作协议？
- 配置与共享：TS 基线、Lint、测试、构建在多包间如何复用？

### 工程化与发布
- 构建链路为何选 tsup？产物格式（ESM/CJS/类型声明/源码映射）如何规划？
- `exports`、`types`、`sideEffects` 的设置及 tree‑shaking 验证方式？
- 版本策略与发布流程（语义化、预发、回滚、变更日志）？如何处理多包协同升级？

### HTTP SDK（中间件/可靠性）
- 中间件顺序：鉴权→去重→限流→熔断→重试→遥测，你的实际顺序与理由？
- 重试策略：幂等判定、退避与抖动公式、触发条件的边界（超时/5xx/网络离线/429）？
- 去重键如何生成（URL/方法/Query/Body/Headers 归一化）？TTL 与内存上限？
- 限流算法选择（Token Bucket/Leaky Bucket），按全局/路由/用户的维度怎么配？
- 熔断状态机切换条件与窗口统计口径？与重试/限流如何解耦？
- 取消与超时：`AbortController` 与内部重试的竞态如何处理？

### Realtime/WebSocket
- 心跳/超时与重连策略（退避、最大重连时长、前后台切换的处理）？
- 消息可靠性：ACK/有序性/去重如何实现？断线重放怎么做？
- 多标签页复用连接：`BroadcastChannel` 或 SharedWorker 的主选举与故障转移？
- 背压：高频消息如何批处理/节流？服务器端限速的反馈与降级？

### 性能采集（Web Vitals/PerformanceObserver）
- LCP/CLS/INP/TTFB 的定义、阈值与采样策略？SPA 路由切换如何复位与二次采集？
- `PerformanceObserver` 去重与 bfcache、`visibilitychange`、`pagehide` 的处理细节？
- 长任务（Long Task）与资源级性能如何归因？页面关闭时保证送达的策略？

### Telemetry/埋点与数据治理
- 事件 Schema 版本演进与兼容？PII 脱敏与采样/限流策略？
- 存储层（IndexedDB/LocalStorage）选型、批量上报、失败重试与幂等保证？
- 链路追踪：traceId/spanId 的生成与跨请求/跨模块传播？

### Adapters（React/Vue）
- Hook/指令的订阅与清理，如何应对 React StrictMode 的双调用？
- SSR/Hydration 场景如何禁用或延迟实时连接与性能采集？

### 并发与跨页协作
- 锁与任务队列的设计：公平性、可重入、超时回收与崩溃恢复？
- 多标签页共享队列/令牌：如何避免“惊群效应”？

### 安全与隐私
- Token 存放策略（Cookie/Storage/Memory）与刷新并发抖动问题？
- CORS、CSRF、防 XSS、CSP 与第三方脚本隔离如何处理？

### 质量与可观测
- 测试金字塔：如何对 WebSocket/网络异常做契约与端到端测试？
- 混沌注入与容灾演练怎么玩，哪些指标能证明有效？
- 线上指标看板：关键 SLO/KPI 是什么？出现劣化如何定位？

### 结果与度量
- 落地成效：体积、首包、错误率、重试成功率、丢数率的量化改善？
- 与既有方案 AB 对比的结论与代价？

### 现场手写/白板题（任选其二）
- 带抖动的指数退避重试（支持 Abort、幂等白名单）。
- 熔断器三态与滑动窗口失败率统计（半开探测/放量）。
- Token Bucket 限流（全局+每路由两级）。

### 杀手级追问
- 重试/熔断/限流/去重的相互作用次序在边界场景下如何冲突消解？
- Safari/移动端在 `sendBeacon`/keepalive/页面关闭上的兼容坑与兜底？
- 大量待重放事件的内存上限、淘汰策略与可观测性如何设计？

需要我基于这份题库给你做一轮“模拟面试”，或挑两道现场题给出标准解与评分点吗？